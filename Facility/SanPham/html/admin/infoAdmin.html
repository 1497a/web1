<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
    <link rel="stylesheet" href="../../css/admin.css">
    <link rel="stylesheet" href="../../fontawesome-free-6.2.0-web/css/all.css">
    <link rel="stylesheet" href="../../bootstrap-5.2.2-dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../font_Roboto/Roboto-Bold.ttf">
    <link rel="stylesheet" href="../../../css/themify-icons/themify-icons.css">
    <link rel="stylesheet" href="../../css/product.css">
    <script src="../../js/jquery.min.js"></script>
    <link rel="stylesheet" href="../../../css/style.css">
    <script src="../../../bootstrap-5.0.2-dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../../style.js"></script>
    <link rel="stylesheet" href="../../../css/cart.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.2/sweetalert.min.js"></script>
    <title>Admin</title>
</head>

<body>
    <header>
        <div class="top">
            <div class="tab_menu">
                <i class="fas fa-bars" data-bs-toggle="offcanvas" href="#offcanvasExample" role="button"
                    aria-controls="offcanvasExample"></i>
                <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasExample"
                    aria-labelledby="offcanvasExampleLabel" style="width: 250px;">
                    <div class="sidebar">
                        <div class="close_tab">
                            <i class="fas fa-xmark" data-bs-dismiss="offcanvas"></i>
                        </div>
                        <div class="user">
                            <div class="user_avatar">
                                <i class="fa-solid fa-user fa-2x"></i>
                            </div>
                            <div>
                                <div class="user_name">
                                    <a href="./infoAdmin.html" style="color:aliceblue;"></a>
                                </div>
                                <div class="user_designation">
                                    <p>Chào mừng bạn trở lại</p>
                                </div>
                            </div>
                            <hr>
                        </div>
                        <div class="menu">
                            <a href="./admin.html">
                                <li class="menu_item active"><i class="fas fa-house"></i>Trang chủ</li>
                            </a>
                            <a href="./data_product.html">
                                <li class="menu_item"><i class="fas fa-tag"></i>Quản lý sản phẩm</li>
                            </a>
                            <a href="./data_oder.html">
                                <li class="menu_item"><i class="fas fa-bag-shopping"></i>Quản lý đơn hàng</li>
                            </a>
                            <a href="./data_user.html">
                                <li class="menu_item"><i class="fas fa-address-card"></i>Quản lý người dùng</li>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="sign_out">
                <a href="#" onclick="logoutAdmin()"><i class="fas fa-right-from-bracket"></i></a>
            </div>
        </div>
        <div class="sidebar">
            <div class="user">
                <div class="user_avatar">
                    <i class="fa-solid fa-user fa-2x"></i>
                </div>
                <div>
                    <div class="user_name">
                        <a href="./infoAdmin.html" style="color:aliceblue;"></a>
                    </div>
                    <div class="user_designation">
                        <p>Chào mừng bạn trở lại</p>
                    </div>
                </div>
                <hr>
            </div>
            <div class="menu">
                <a href="./admin.html">
                    <li class="menu_item active"><i class="fas fa-house"></i>Trang chủ</li>
                </a>
                <a href="./data_product.html">
                    <li class="menu_item"><i class="fas fa-tag"></i>Quản lý sản phẩm</li>
                </a>
                <a href="./data_oder.html">
                    <li class="menu_item"><i class="fas fa-bag-shopping"></i>Quản lý đơn hàng</li>
                </a>
                <a href="./data_user.html">
                    <li class="menu_item"><i class="fas fa-address-card"></i>Quản lý người dùng</li>
                </a>
            </div>
        </div>
    </header>

    <div class="content">
        <div class="row">
            <div class="title col-12 box_shadow">
                <ul class="line_up">
                    <li>Tài khoản quản trị viên</li>
                </ul>
            </div>
        </div>
        <div class="row main_frame box_card box_shadow">
            <div class="sub_title">
                <h5><b></b></h5>
                <div></div>
            </div>
            <div class="form_add">
                <div class="form_group col-12 col-sm-6 col-lg-6" style="display: flex; flex-direction: column;">
                    <label for="usernameAdmin" style="width: 30%;">Tên đăng nhập</label>
                    <input style="width: 50%;" type="text" class="form-control" id="usernameAdmin" />
                    <small class="error-message" style="height:20px; color: red; display: block;"></small>
                </div>
            
                <div class="form_group col-12 col-sm-6 col-lg-6" style="display: flex; flex-direction: column;">
                    <label for="nameAdmin" style="width: 30%;">Họ tên</label>
                    <input style="width: 50%;" type="text" class="form-control" id="nameAdmin" />
                    <small class="error-message" style=" height:20px;color: red; display: block;"></small>
                </div>
            
                <div class="form_group col-12 col-sm-6 col-lg-6" style="display: flex; flex-direction: column;">
                    <label for="emailAdmin" style="width: 30%;">Email</label>
                    <input style="width: 50%;" type="email" class="form-control" id="emailAdmin" />
                    <small class="error-message" style="height:20px; color: red; display: block;"></small>
                </div>
            
                <div class="form_group col-12 col-sm-6 col-lg-6" style="display: flex; flex-direction: column;">
                    <label for="phoneAdmin" style="width: 30%;">Số điện thoại</label>
                    <input style="width: 50%;" type="text" class="form-control" id="phoneAdmin" />
                    <small class="error-message" style="height:20px; color: red; display: block;"></small>
                </div>
            
                <div class="form_group col-12 col-sm-6 col-lg-6" style="display: flex; flex-direction: column;">
                    <label for="passwordAdmin" style="width: 30%;">Mật khẩu</label>
                    <input style="width: 50%;" type="password" class="form-control" id="passwordAdmin" disabled/>
                    <small class="error-message" style="height:20px; color: red; display: block; cursor:not-allowed;"></small>
                </div>
            
                <div class="element_btn">
                    <div class="add_product">
                        <a delay="10000" type="button" class="addnew_btn" onclick="updateAdminInfo()">Lưu</a>
                    </div>
                </div>
            </div>
            
        </div>
    </div>

    <script>
        function renderAdminForm() {
            const admins = JSON.parse(localStorage.getItem('admins')) || [];
            const signedInAdmin = admins.find(admin => admin.isSignIn === 1);

            if (signedInAdmin) {
                document.getElementById('usernameAdmin').value = signedInAdmin.username || '';
                document.getElementById('nameAdmin').value = signedInAdmin.name || '';
                document.getElementById('emailAdmin').value = signedInAdmin.email || '';
                document.getElementById('phoneAdmin').value = signedInAdmin.phone || '';
                document.getElementById('passwordAdmin').value = signedInAdmin.password || '';
            } else {
                console.warn('Không có admin nào đang đăng nhập.');
            }
        }

        document.addEventListener('DOMContentLoaded', renderAdminForm);

        // Hàm cập nhật thông tin admin với thông báo lỗi qua thẻ <small>
            function updateAdminInfo() {
            // Lấy thông tin từ các input
            const username = document.getElementById('usernameAdmin').value.trim();
            const name = document.getElementById('nameAdmin').value.trim();
            const email = document.getElementById('emailAdmin').value.trim();
            const phone = document.getElementById('phoneAdmin').value.trim();
            const password = document.getElementById('passwordAdmin').value.trim();

            // Lấy tất cả các thẻ <small> để hiển thị lỗi
            const errorMessages = document.querySelectorAll('.error-message');

            // Xóa thông báo lỗi cũ
            errorMessages.forEach(small => {
                small.textContent = '';
            });

            // Biến kiểm tra lỗi
            let isValid = true;

            // Validate từng trường
            if (!username) {
                document.getElementById('usernameAdmin').nextElementSibling.textContent = 'Tên đăng nhập không được để trống.';
                isValid = false;
            }

            if (!name) {
                document.getElementById('nameAdmin').nextElementSibling.textContent = 'Họ tên không được để trống.';
                isValid = false;
            }

            if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                document.getElementById('emailAdmin').nextElementSibling.textContent = 'Email không hợp lệ.';
                isValid = false;
            }

            if (!phone || !/^\d{10,11}$/.test(phone)) {
                document.getElementById('phoneAdmin').nextElementSibling.textContent = 'Số điện thoại phải gồm 10-11 chữ số.';
                isValid = false;
            }

            if (!password || password.length < 6) {
                document.getElementById('passwordAdmin').nextElementSibling.textContent = 'Mật khẩu phải có ít nhất 6 ký tự.';
                isValid = false;
            }

            // Nếu không có lỗi, cập nhật thông tin admin
            if (isValid) {
                const admins = JSON.parse(localStorage.getItem('admins')) || [];
                const signedInAdmin = admins.find(admin => admin.isSignIn === 1);

                if (signedInAdmin) {
                    signedInAdmin.username = username;
                    signedInAdmin.name = name;
                    signedInAdmin.email = email;
                    signedInAdmin.phone = phone;
                    signedInAdmin.password = password;

                    // Lưu lại vào localStorage
                    localStorage.setItem('admins', JSON.stringify(admins));

                    alert('Cập nhật thông tin thành công!');
                } else {
                    alert('Không tìm thấy thông tin admin đang đăng nhập.');
                }
            }
        }

    </script>
    <!-- ----------------------- Script ----------------------- -->
    <script src="../../bootstrap-5.2.2-dist/js/bootstrap.bundle.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
    <script src="../../js/jquery.min.js"></script>
    <script src="../../js/data.js"></script>
    <script src="../../js/admin.js"></script>
    <script src="../../js/account.js"></script>
    <script src="../../js/statistic.js"></script>
    <script src="../../js/accountAdmin.js"></script>
    <script src="../../js/checkSignInAdmin.js"></script>
</body>

</html>