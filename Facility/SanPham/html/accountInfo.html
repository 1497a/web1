<!DOCTYPE html>
<html lang="vn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tài khoản của tôi</title>
    <link rel="stylesheet" href="../../SanPham/fontawesome-free-6.2.0-web/css/all.css">
    <link rel="stylesheet" href="../../SanPham/bootstrap-5.2.2-dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../SanPham/font_Roboto/Roboto-Bold.ttf">
    <link rel="stylesheet" href="../../css/themify-icons/themify-icons.css">
    <link rel="stylesheet" href="../../SanPham/css/product.css">
    <script src="../..//SanPham/js/jquery.min.js"></script>
    <link rel="stylesheet" href="../../css/style.css">
    <script src="../../bootstrap-5.0.2-dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../style.js"></script>
    <link rel="stylesheet" href="../../css/cart.css">
    <link rel="stylesheet" href="../css/accountInfo.css">

</head>
</head>
<style>
    .form-group .input-wrapper .dropdown {
        display: none;
        position: absolute;
        border: 1px solid #ddd;
        background-color: white;
        width: 200px;
        max-height: 200px;
        overflow-y: auto;
        z-index: 10;
    }

    .form-group .input-wrapper .dropdown .dropdown-item {
        padding: 10px;
        cursor: pointer;
    }

    .form-group .input-wrapper .dropdown .dropdown-item:hover {
        background-color: #f0f0f0;
    }

    .form-container input {
        padding: 10px;
        width: 300px;
    }

    .container-order {
        display: flex;
        width: 80%;
        margin-top: 80px;
        margin-bottom: 80px;
    }

    .sidebar {
        width: 250px;
        /* background-color: #fff; */
        padding: 20px;
        /* box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1); */
        height: 100vh;
    }

    .profile {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-bottom: 30px;
    }

    .avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        margin-bottom: 10px;
    }

    .user-name p {
        font-weight: bold;
        color: #333;
        margin-bottom: 5px;
    }

    .user-name a {
        font-size: 14px;
        color: #007bff;
        text-decoration: none;
    }

    .menu-item {
        text-decoration: none;
        color: #333;
        padding: 10px;
        border-radius: 5px;
        display: inline-block;
        margin-bottom: 10px;
        /* Thêm khoảng cách giữa các mục */
        transition: background-color 0.3s, color 0.3s;
    }

    .menu-item:hover {
        background-color: #f0f0f0;
    }

    .menu-item.active {
        color: blue;
    }
</style>

<body>
    <header>
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
            <div class="container">
                <a class="navbar-brand" href="../../Index.html">
                    <img src="../../SanPham/img/logo.png">
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0" style="width: 28em">
                        <li class="nav-item">
                            <a class="nav-link " href="../../Index.html">Trang chủ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="../../header/GioiThieu.html">Giới thiệu</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="../../SanPham/html/category/product.html"
                                id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                                Sản Phẩm
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                                <li><a class="dropdown-item" href="javascript:void(0)"
                                        onclick='updateUrl(["all"], [])'>Tất cả sản phẩm</a></li>
                                <li>
                                    <hr class="dropdown-divider">
                                </li>
                                <li><a class="dropdown-item" href="javascript:void(0)"
                                        onclick='updateUrl(["Bàn gỗ"], [])'>Bàn Gỗ</a></li>
                                <li>
                                    <hr class="dropdown-divider">
                                </li>
                                <li><a class="dropdown-item" href="javascript:void(0)"
                                        onclick="updateUrl(['Kệ sách'], [])">Kệ Sách</a></li>
                                <li>
                                    <hr class="dropdown-divider">
                                </li>
                                <li><a class="dropdown-item" href="javascript:void(0)"
                                        onclick="updateUrl(['Rèm cửa'], [])">Rèm Cửa</a></li>
                                <li>
                                    <hr class="dropdown-divider">
                                </li>
                                <li><a class="dropdown-item" href="javascript:void(0)"
                                        onclick="updateUrl(['Ghế sofa'], [])">Ghế Sofa</a></li>
                                <li>
                                    <hr class="dropdown-divider">
                                </li>
                                <li><a class="dropdown-item" href="javascript:void(0)"
                                        onclick="updateUrl(['Tủ quần áo'], [])">Tủ Quần Áo</a></li>
                                <li>
                                    <hr class="dropdown-divider">
                                </li>
                                <li><a class="dropdown-item" href="javascript:void(0)"
                                        onclick="updateUrl(['Giường ngủ'], [])">Giường Ngủ</a></li>
                                <li>
                                    <hr class="dropdown-divider">
                                </li>
                                <li><a class="dropdown-item" href="javascript:void(0)"
                                        onclick="updateUrl(['Phòng tắm'], [])">Phòng Tắm</a></li>
                                <li>
                                    <hr class="dropdown-divider">
                                </li>
                                <li><a class="dropdown-item" href="javascript:void(0)"
                                        onclick="updateUrl(['Đèn trang trí'], [])">Đèn trang trí</a></li>
                            </ul>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link " href="../../header/TinTuc.html">Tin tức</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link " href="../../header/LienHe.html">Liên Hệ</a>
                        </li>
                    </ul>
                    <form class="d-flex display: block">
                        <input class="form-control search-input" type="text" placeholder="Tìm" aria-label="Search"
                            id="myInput" onkeyup="myFunction()">
                        <ul id="myUL" class="list-group searchInput mt-1">
                            <li><a href="../../SanPham/html/category/detail_item/Ban/ban2.html"
                                    class="list-group-item list-group-item-action">bàn GTY 091</a></li>
                            <li><a href="../../SanPham/html/category/detail_item/tu_quan_ao/tu2.html"
                                    class="list-group-item list-group-item-action">Tủ áo B1241K</a></li>

                            <li><a href="../../SanPham/html/category/detail_item/ke_sach/ke1.html"
                                    class="list-group-item list-group-item-action">Kệ sách gỗ 4 tầng 40</a></li>
                            <li><a href="../../SanPham/html/category/detail_item/rem_cua/rem1.html"
                                    class="list-group-item list-group-item-action">Rèm Cửa 01</a></li>

                            <li><a href="../../SanPham/html/category/detail_item/phong_tam/tam1.html"
                                    class="list-group-item list-group-item-action">Thanh treo giấy vệ sinh</a></li>
                            <li><a href="../../SanPham/html/category/detail_item/sofa/sofa2.html"
                                    class="list-group-item list-group-item-action">Sofa Cafe</a></li>
                            <li><a href="../../SanPham/html/category/detail_item/giuong_ngu/giuong4.html"
                                    class="list-group-item list-group-item-action">Giường Bellasofa B1239</a></li>

                        </ul>

                        <button class="btn btn-primary search-btn" type="button" onclick="redirectToProductPage()"><span
                                class="ti-search"></span></button>
                    </form>
                    <div class="icon-user">
                        <li class="nav-item dropdown">
                            <a class="fas fa-user nav-link dropdown-toggle" id="navbarDropdown" role="button"
                                data-bs-toggle="dropdown"></a>
                            <ul class="dropdown-menu">
                                <li>
                                    <a href="../../SanPham/html/Dangnhap.html" class="dropdown-item">
                                        Đăng Nhập</a>
                                </li>
                                <li class="dropdown-divider"></li>
                                <li>
                                    <a href="../../SanPham/html/Dangky.html" class="dropdown-item">
                                        Đăng Ký
                                    </a>
                                </li>
                            </ul>
                        </li>
                    </div>
                    <a href="./cart.html" title="Mua hàng" class="cart">
                        <li class="fas fa-cart-shopping"><span>0</span></li>
                    </a>
                </div>
            </div>
        </nav>
    </header>

    <div class="container-order">
        <!-- Thanh menu bên trái -->
        <div class="sidebar">
            <div class="profile">
                <img src="https://i.natgeofe.com/n/548467d8-c5f1-4551-9f58-6817a8d2c45e/NationalGeographic_2572187_2x3.jpg"
                    alt="Avatar" class="avatar">
                <div class="user-name">
                    <p></p>
                </div>
            </div>
            <div class="menu-items">
                <a href="./accountInfo.html" class="menu-item active"><span class="icon">👤</span> Tài Khoản Của Tôi</a>
                <a href="./user_order.html" class="menu-item"><span class="icon">📋</span> Đơn Mua</a>
            </div>
        </div>
        <!-- Phần lịch sử đơn hàng -->
        <div class="profile-container">
            <h4>Hồ Sơ Của Tôi</h4>
            <p>Quản lý thông tin hồ sơ để bảo mật tài khoản</p>

            <form id="accountForm">
                <div class="form-group">
                    <label for="username">Tên đăng nhập</label>
                    <input type="text" id="username" value="" disabled>
                    <small class="form-message" id="username-error"></small>
                </div>

                <div class="form-group">
                    <label for="name">Tên</label>
                    <input type="text" id="name" value="">
                    <small class="form-message" id="name-error"></small>
                </div>

                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" value="">
                    <small class="form-message" id="email-error"></small>
                </div>

                <div class="form-group">
                    <label for="phone">Số điện thoại</label>
                    <input type="text" id="phone" value="">
                    <small class="form-message" id="phone-error"></small>
                </div>

                <div class="form-group">
                    <label for="password">Mật khẩu</label>
                    <input type="password" id="password" value="" disabled>
                    <small class="form-message" id="password-error"></small>
                </div>

                <div class="form-group">
                    <label for="adress">Địa chỉ</label>
                    <div class="input-wrapper" style="width: 40%;">
                        <input style="width: 100%;padding: 10px;" type="text" class="form-control" name="address"
                            id="address" value="">
                        <div id="addressDropdown" class="dropdown"></div>
                        <div id="districtDropdown" class="dropdown"></div>
                        <div id="wardDropdown" class="dropdown"></div>
                    </div>
                    <small class="form-message" id="address-error"></small>
                </div>
                
                <div class="form-group">
                    <label>Giới tính</label>
                    <div class="checkbox-gender">
                        <label class="label-gender"><input type="radio" name="gender" value="Nam"> Nam</label>
                        <label class="label-gender"><input type="radio" name="gender" value="Nữ"> Nữ</label>
                    </div>
                    <small class="form-message" id="gender-error"></small>
                </div>

                <div class="form-group">
                    <label for="dob">Ngày sinh</label>
                    <input type="date" id="dob" value="">
                    <small class="form-message" id="dob-error"></small>
                </div>

                <button type="button" class="save-button" onclick="saveUserInfo()">Lưu</button>
            </form>


        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12 col-md-12 col-lg-3 intro">
                    <h4>GIỚI THIỆU</h4>
                    <p>Đến với Dekor, bạn hoàn toàn yên tâm để chọn được cho mình một bộ nội thất phù hợp nhất, kết hợp
                        đầy đủ, hài hòa các yếu tố về màu sắc, kiểu dáng, kích thước để làm cho không gian ngôi nhà bạn
                        trở nên ấn tượng hơn!</p>
                    <ul>
                        <li><a href=""><i class="ti-facebook"></i></a></li>
                        <li><a href=""><i class="ti-twitter"></i></a></li>
                        <li><a href=""><i class="ti-email"></i></a></li>
                        <li><a href=""><i class="ti-youtube"></i></a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-md-6 col-lg-3 policy news">
                    <h4>CHÍNH SÁCH</h4>
                    <div class="news_item row"
                        style="display: inline-block; margin-right: 10px; position: relative; padding-left: 20px;">
                        <span>●</span>
                        Chính sách bảo hành
                    </div>
                    <div class="news_item row"
                        style="display: inline-block; margin-right: 10px; position: relative; padding-left: 20px;">
                        <span>●</span>
                        Chính sách bảo mật
                    </div>
                    <div class="news_item row"
                        style="display: inline-block; margin-right: 10px; position: relative; padding-left: 20px;">
                        <span>●</span>
                        Chính sách đổi trả
                    </div>
                    <div class="news_item row"
                        style="display: inline-block; margin-right: 10px; position: relative; padding-left: 20px;">
                        <span>●</span>
                        Chính sách giao hàng
                    </div>
                    <div class="news_item row"
                        style="display: inline-block; margin-right: 10px; position: relative; padding-left: 20px;">
                        <span>●</span>
                        Chính sách thanh toán
                    </div>
                </div>


                <div class="col-xs-12 col-md-6 col-lg-3 addr">
                    <h4>ĐỊA CHỈ LIÊN HỆ</h4>
                    <p><i class="fas fa-location-dot"></i>Đường Số 1, Quận 1, TP. Hồ Chí Minh, Việt Nam</p>
                    <p class="phone_num"><i class="fas fa-phone"></i><a href="">+84 123 456 789</a></p>
                    <p>
                    <form class="form">
                        <input type="email" class="form__field" placeholder="Đăng Ký Subscribe Email" />
                        <button type="button" class="asd btn btn-primary ">Gửi</button>
                    </form>
                    </p>
                </div>
                <div class="col-xs-12 col-md-6 col-lg-3 news">
                    <h4>TIN MỚI</h4>
                    <div class="news_item row">
                        <div class="col-2 news_img">
                            <img src="../../SanPham/img/news/news_1.png">
                        </div>
                        <div class="col-9 news_info">
                            <h5><a href="../../header/TinTuc1.html">Bí quyết bảo quản nội thất gỗ</a></h5>
                            <p>11/11/2022</p>
                        </div>
                    </div>
                    <div class="news_item row">
                        <div class="col-2 news_img">
                            <img src="../../SanPham/img/news/news_2.png">
                        </div>
                        <div class="col-9 news_info">
                            <h5><a href="../../header/Tintuc2.html">Kinh nghiệm mua, bảo quản nội thất</a></h5>
                            <p>11/11/2022</p>
                        </div>
                    </div>
                    <div class="news_item row">
                        <div class="col-2 news_img">
                            <img src="../../SanPham/img/news/news_3.png" alt="">
                        </div>
                        <div class="col-9 news_info">
                            <h5><a href="../../header/Tintuc3.html">Bố trí nội thất, cần tránh những gì ?</a></h5>
                            <p>11/11/2022</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!--Kết Thúc Phần Nội Dung-->
    <script src="../../SanPham/js/data.js"></script>
    <script src="../../SanPham/js/account.js"></script>
    <script>
        function updateUrl(categories, brands) {
            // Mã hóa categories và brands thành chuỗi JSON và sau đó mã hóa URL
            const encodedCategories = (JSON.stringify(categories));
            const encodedBrands = (JSON.stringify(brands));

            // Cập nhật URL với các tham số mới
            const url = new URL(getBasePath() + '/SanPham/html/category/product.html'); // Chuyển hướng đến trang sản phẩm
            url.searchParams.set('categories', encodedCategories);
            url.searchParams.set('brands', encodedBrands);

            // Chuyển hướng đến URL mới
            window.location.href = url.toString();
        }


        function populateProfile() {
            const users = JSON.parse(localStorage.getItem('users')) || [];
            const loggedInUser = users.find(user => user.isSignIn === 1); // Kiểm tra user đang đăng nhập

            if (!loggedInUser) {
                console.error("Không có user nào đang đăng nhập!");
                return;
            }

            // Lấy các phần tử input và điền thông tin của user vào
            document.getElementById('username').value = loggedInUser.username || '';  // Tên đăng nhập
            document.getElementById('name').value = loggedInUser.name || '';  // Tên
            document.getElementById('email').value = loggedInUser.account || '';  // Email
            document.getElementById('phone').value = loggedInUser.phone || '';  // Số điện thoại
            document.getElementById('address').value = loggedInUser.address || '';  // Số điện thoại
            document.getElementById('password').value = loggedInUser.password || '';  // Số điện thoại
            document.querySelector(".user-name p").innerHTML = loggedInUser.name
            console.log(document.querySelector(".user-name p"));
            if (loggedInUser.birthdate) {
                const date = new Date(loggedInUser.birthdate); // Chuyển chuỗi thành Date
                const formattedDate = date.toISOString().split('T')[0]; // Chuyển sang YYYY-MM-DD
                document.getElementById('dob').value = formattedDate; // Gán giá trị cho input kiểu date
            } else {
                document.getElementById('dob').value = ''; // Nếu không có ngày sinh
            }


            // Giới tính
            if (loggedInUser.gender) {
                const genderRadio = document.querySelector(`input[name="gender"][value="${loggedInUser.gender}"]`);
                if (genderRadio) {
                    genderRadio.checked = true;
                }

                if (loggedInUser.gender === "Nữ") {
                    document.querySelector(".avatar").src = "../../img/avatar-mac-dinh-facebook-nu.jpg";
                }
                if (loggedInUser.gender === "Nam") {
                    document.querySelector(".avatar").src = "../../img/avatar-mac-dinh-nam.jpg";
                }
            }
            setupAddressDropdown("address");
        }



        function updateCartIcon(cart) {
            const cartIcon = document.querySelector(".cart li span");
            if (cartIcon) {
                const totalQuantity = cart.reduce((total, item) => total + item.quantity, 0);
                cartIcon.innerText = totalQuantity;
            }
        }


        window.onload = function () {
            const users = JSON.parse(localStorage.getItem("users")) || [];
            const currentUser = users.find(user => user.isSignIn === 1);
            if (currentUser) {
                updateCartIcon(currentUser.cart);
                populateProfile();
            }
        };

        function validateAccountForm() {
            let isValid = true;

            // Xóa các thông báo lỗi cũ
            const errorMessages = document.querySelectorAll(".form-message");
            errorMessages.forEach(msg => msg.textContent = "");

            // Kiểm tra tên
            const name = document.getElementById("name").value;
            if (name === "") {
                document.getElementById("name-error").textContent = "Tên không được để trống!";
                isValid = false;
            }

            // Kiểm tra email
            const email = document.getElementById("email").value;
            if (email === "") {
                document.getElementById("email-error").textContent = "Email không được để trống!";
                isValid = false;
            } else if (!/^[a-zA-Z0-9]+@gmail\.com$/.test(email)) {
                document.getElementById("email-error").textContent = "Email không hợp lệ!";
                isValid = false;
            } else if (isEmailExist(email)) {
                document.getElementById("email-error").textContent = "Email đã tồn tại!";
                isValid = false;
            }

            // Kiểm tra số điện thoại
            const phone = document.getElementById("phone").value;
            if (phone === "") {
                document.getElementById("phone-error").textContent = "Số điện thoại không được để trống!";
                isValid = false;
            } else if (!/^\d{10}$/.test(phone)) {
                document.getElementById("phone-error").textContent = "Số điện thoại phải có 10 chữ số!";
                isValid = false;
            }

            // Kiểm tra địa chỉ
            const address = document.getElementById("address").value;
            if (address === "") {
                document.getElementById("address-error").textContent = "Địa chỉ không được để trống!";
                isValid = false;
            }

            // Kiểm tra giới tính
            const gender = document.querySelector('input[name="gender"]:checked');
            if (!gender) {
                document.getElementById("gender-error").textContent = "Bạn phải chọn giới tính!";
                isValid = false;
            }

            // Kiểm tra ngày sinh
            const dob = document.getElementById("dob").value;
            if (dob === "") {
                document.getElementById("dob-error").textContent = "Ngày sinh không được để trống!";
                isValid = false;
            }

            return isValid;
        }

        function isEmailExist(email) {
            const users = JSON.parse(localStorage.getItem("users")) || [];

            // Tìm người dùng hiện tại (isSignIn = 1)
            const currentUser = users.find(user => user.isSignIn === 1);

            // Kiểm tra xem email có trùng với email của người dùng hiện tại không, nếu có thì bỏ qua
            return users.some(user => user.account === email && user.account !== currentUser?.account);
        }



        function saveUserInfo() {
            const username = document.getElementById("username").value;
            const name = document.getElementById("name").value;
            const email = document.getElementById("email").value;
            const phone = document.getElementById("phone").value;
            const address = document.getElementById("address").value;
            const gender = document.querySelector('input[name="gender"]:checked')?.value || "";
            const birthdate = document.getElementById("dob").value;
            const password = document.getElementById("password").value;  // Password không thay đổi vì disabled

            // Kiểm tra tính hợp lệ
            if (!validateAccountForm()) return; // Nếu không hợp lệ thì không tiếp tục

            const users = JSON.parse(localStorage.getItem("users")) || [];

            // Tìm người dùng hiện tại
            const currentUser = users.find(user => user.username === username);

            if (currentUser) {
                // Cập nhật thông tin người dùng
                currentUser.name = name;
                currentUser.account = email;
                currentUser.phone = phone;
                currentUser.address = address;
                currentUser.gender = gender;
                currentUser.birthdate = birthdate;

                // Cập nhật lại vào localStorage
                localStorage.setItem("users", JSON.stringify(users));

                alert("Cập nhật thông tin thành công!");
                populateProfile();  // Cập nhật giao diện với thông tin mới
            } else {
                alert("Không tìm thấy tài khoản để cập nhật.");
            }
        }
    </script>
</body>

</html>